"use strict";var Poker=function(){var e=this;this.body=document.body,this.popup=document.querySelector(".popup"),this.popupClose=document.querySelector(".popup__close"),this.cardList=document.querySelector(".card__list"),this.isMobile=!!navigator.userAgent.match(/iPad|iPhone|Mobile|Android|Windows Phone/g),this.showPercent=function(e,t){var n=Math.round(e/t*100),o=document.querySelector(".preload__percent"),i=document.querySelector(".preload__line");o.setAttribute("data-percent",n),i.style.cssText="-webkit-transform: translate3d(-"+(100-n)+"%,0,0);\n                                     transform: translate3d(-"+(100-n)+"%,0,0)"},this.setCardSize=function(){var e=document.getElementsByClassName("card__item"),t=document.querySelector(".container"),n=t.clientHeight,o=window.innerWidth<window.innerHeight?5:2;[].forEach.call(e,function(e){e.style.height=n/o+"px"})},this.setPopupContent=function(e){var t=document.querySelector(".popup__image use"),n=document.querySelector(".popup__title"),o=document.getElementsByClassName("card__title")[e-1],i=document.querySelector(".popup__desc");t.setAttribute("xlink:href","#"+e),n.innerText=""+o.innerText,i.innerText=""+o.getAttribute("data-desc")},this.openPopup=function(){null!==e.focusedEl&&e.popupClose.focus(),e.popup.classList.add("popup--open")},this.closePopup=function(){null!==e.focusedEl&&e.focusedEl.focus(),e.popup.classList.remove("popup--open")},this.setTransformOrigin=function(t,n){e.popup.style.cssText="-webkit-transform-origin: "+t+"% "+n+"% 0;\n                                    transform-origin: "+t+"% "+n+"% 0;"},this.buildPopup=function(){var t=Math.round(event.pageX/window.innerWidth*100)||"50",n=Math.round(event.pageY/window.innerHeight*100)||"50",o=event.target;"svg"==event.target.tagName||"card__title"==event.target.className?o=event.target.parentNode:"use"==event.target.tagName&&(o=event.target.parentNode.parentNode),e.setTransformOrigin(t,n),e.setPopupContent(o.getAttribute("data-card")),e.focusedEl=e.isMobile?null:o,e.openPopup()},this.actionHandler=function(){var t=event.type;"keydown"===t?13!==event.keyCode&&32!==event.keyCode||e.buildPopup():"click"===t&&e.buildPopup()},this.setHref=function(){var t=document.querySelectorAll(".card__image use"),n=document.querySelector(".preload");[].forEach.call(t,function(e,t){e.setAttribute("xlink:href","#"+(t+1))}),e.body.removeChild(n)},this.preloadSprite=function(){var t=new XMLHttpRequest;t.open("GET","img/sprite.svg",!0),t.send(),t.onprogress=function(){event.lengthComputable&&e.showPercent(event.loaded,event.total)},t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&200===t.status&&(e.body.innerHTML+=event.target.response,e.setHref())}},this.checkUpdate=function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&(window.applicationCache.swapCache(),confirm("A new version of this site is available. Load it?")&&window.location.reload())},this.popupClose.addEventListener("click",this.closePopup),this.cardList.addEventListener("click",this.actionHandler),this.cardList.addEventListener("keydown",this.actionHandler),this.popup.addEventListener("keydown",function(){"9"==event.keyCode?event.preventDefault():"27"==event.keyCode&&e.closePopup()}),this.setCardSize(),window.addEventListener("resize",this.setCardSize),window.applicationCache.addEventListener("updateready",this.checkUpdate)};window.addEventListener("DOMContentLoaded",function(){var e=new Poker;e.preloadSprite()});