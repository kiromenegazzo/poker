"use strict";var Poker=function(){var e=this;this.popup=document.querySelector(".popup"),this.popupClose=document.querySelector(".popup__close"),this.popupImage=document.querySelector(".popup__image use"),this.popupTitle=document.querySelector(".popup__title"),this.popupDesc=document.querySelector(".popup__desc"),this.container=document.querySelector(".container"),this.cardList=document.querySelector(".card__list"),this.cards=document.getElementsByClassName("card__item"),this.isMobile=navigator.userAgent.match(/iPad|iPhone|Mobile|Android|Windows Phone/g),this.focusedEl=null,this.setCardSize=this.setCardSize.bind(this),this.checkUpdate=this.checkUpdate.bind(this),this.actionHandler=this.actionHandler.bind(this),this.popupClose.addEventListener("click",this.closePopup),this.cardList.addEventListener("click",this.actionHandler),this.cardList.addEventListener("keydown",this.actionHandler),this.popup.addEventListener("keydown",function(t){"9"===t.keyCode?t.preventDefault():"27"===t.keyCode&&e.closePopup()}),this.setCardSize(),window.addEventListener("resize",this.setCardSize),window.applicationCache.addEventListener("updateready",this.checkUpdate)};Poker.prototype.setCardSize=function(){var e=this.container.clientHeight,t=window.innerWidth<window.innerHeight?5:2;[].forEach.call(this.cards,function(o){o.style.height=e/t+"px"})},Poker.prototype.setPopupContent=function(e){var t=document.getElementsByClassName("card__title")[e-1];this.popupImage.setAttribute("xlink:href","#"+e),this.popupTitle.innerText=""+t.innerText,this.popupDesc.innerText=""+t.getAttribute("data-desc")},Poker.prototype.openPopup=function(){null!==this.focusedEl&&this.popupClose.focus(),this.popup.classList.add("popup--open")},Poker.prototype.closePopup=function(){null!==this.focusedEl&&this.focusedEl.focus(),this.popup.classList.remove("popup--open")},Poker.prototype.setTransformOrigin=function(e,t){this.popup.style.cssText="-webkit-transform-origin: "+e+"% "+t+"% 0;\n                            transform-origin: "+e+"% "+t+"% 0;"},Poker.prototype.buildPopup=function(){var e=Math.round(event.pageX/window.innerWidth*100)||"50",t=Math.round(event.pageY/window.innerHeight*100)||"50",o=event.target;this.setTransformOrigin(e,t),this.setPopupContent(o.getAttribute("data-card")),this.focusedEl=this.isMobile?null:o,this.openPopup()},Poker.prototype.actionHandler=function(){var e=event.type;"keydown"===e?13!==event.keyCode&&32!==event.keyCode||this.buildPopup():"click"===e&&this.buildPopup()},Poker.prototype.setHref=function(){var e=document.querySelectorAll(".card__image use");Array.prototype.forEach.call(e,function(e,t){e.setAttribute("xlink:href","#"+(t+1))})},Poker.prototype.preloadSprite=function(){var e=this,t=document.body,o=document.querySelector(".preload"),i=new XMLHttpRequest;i.open("GET","img/sprite.svg",!0),i.send(),i.onload=function(i){t.removeChild(o),e.popup.insertAdjacentHTML("afterEnd",i.target.response),e.setHref()}},Poker.prototype.checkUpdate=function(){window.applicationCache&&window.applicationCache.status===window.applicationCache.UPDATEREADY&&(window.applicationCache.swapCache(),confirm("A new version of this site is available. Load it?")&&window.location.reload())},window.addEventListener("DOMContentLoaded",function(){(new Poker).preloadSprite()});