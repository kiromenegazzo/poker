"use strict";var Poker=function(){var e=this;this.popup=document.querySelector(".popup"),this.popupClose=document.querySelector(".popup__close"),this.cardList=document.querySelector(".card__list"),this.isMobile=!!navigator.userAgent.match(/iPad|iPhone|Mobile|Android|Windows Phone/g),this.loadIndex=1,this.combName=["Роял Стрит Флэш","Стрит Флэш","Каре","Фулл хаус","Флеш","Стрит","Тройка","Две пары","Пара","Старшая карта"],this.combDesc=["5 старших карт одной масти","любые пять карт одной масти по порядку","четыре карты одного достоинства","одна тройка и одна пара","пять карт одной масти","пять карт по порядку любых мастей","три карты одного достоинства","две пары карт одного достоинства","две карты одного достоинства","ни одна из вышеописанных комбинаций"],this.showPercent=function(t,n){var o=Math.round(t/n*100),i=document.querySelector(".preload"),a=document.querySelector(".preload__percent"),r=document.querySelector(".preload__line");a.setAttribute("data-percent",o),r.style.cssText="-webkit-transform: translate3d(-"+(100-o)+"%,0,0);\n                                     transform: translate3d(-"+(100-o)+"%,0,0)",t==n&&(document.body.removeChild(i),e.setCardSize())},this.setCardSize=function(){var t=e.cardList.children,n=document.querySelector(".container").clientHeight,o=window.innerWidth<window.innerHeight?5:2;[].forEach.call(t,function(e){e.style.cssText="height:"+n/o+"px"})},this.setPopupContent=function(t){var n=document.querySelector(".popup__image use"),o=document.querySelector(".popup__title"),i=document.querySelector(".popup__desc");n.setAttribute("href","img/sprite.svg#1"),o.innerText=""+e.combName[t-1],i.innerText=""+e.combDesc[t-1]},this.openPopup=function(){null!==e.focusedEl&&e.popupClose.focus(),e.popup.classList.add("popup--open")},this.closePopup=function(){null!==e.focusedEl&&e.focusedEl.focus(),e.popup.classList.remove("popup--open")},this.setTransformOrigin=function(t,n){e.popup.style.cssText="-webkit-transform-origin: "+t+"% "+n+"% 0;\n                                    transform-origin: "+t+"% "+n+"% 0;"},this.buildPopup=function(){var t=Math.round(event.pageX/window.innerWidth*100)||"50",n=Math.round(event.pageY/window.innerHeight*100)||"50",o=event.target;"svg"==event.target.tagName||"card__title"==event.target.className?o=event.target.parentNode:"use"==event.target.tagName&&(o=event.target.parentNode.parentNode),e.setTransformOrigin(t,n),e.setPopupContent(o.getAttribute("data-card")),e.openPopup(),e.focusedEl=e.isMobile?null:o},this.actionHandler=function(){var t=event.type;"keydown"===t?13!==event.keyCode&&32!==event.keyCode||e.buildPopup():"click"===t&&e.buildPopup()},this.loadImage=function(){return new Promise(function(t,n){var o=new Image;o.src="img/hand-"+e.loadIndex+".png",o.onload=function(){e.showPercent(e.loadIndex,e.combName.length),t(o.src),e.loadIndex!==e.combName.length&&(e.loadIndex++,e.loadImage())},o.onerror=function(){return n()}})},this.preloadImages=function(){for(var t=[],n=e.combName.length,o=0,i=1;i<n+1;i++)t[i]=new Image,t[i].src="img/hand-"+i+".png",t[i].onload=function(){o++,e.showPercent(o,n),o==n&&e.setCardSize()}},this.checkUpdate=function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&(window.applicationCache.swapCache(),confirm("A new version of this site is available. Load it?")&&window.location.reload())},this.popupClose.addEventListener("click",this.closePopup),this.cardList.addEventListener("click",this.actionHandler),this.cardList.addEventListener("keydown",this.actionHandler),this.popup.addEventListener("keydown",function(){"9"==event.keyCode&&event.preventDefault()}),window.addEventListener("resize",this.setCardSize),window.applicationCache.addEventListener("updateready",this.checkUpdate)};window.addEventListener("DOMContentLoaded",function(){var e=new Poker;window.Promise?e.loadImage():e.preloadImages()});